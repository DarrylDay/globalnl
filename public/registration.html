<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Global NL - Registration</title>

<link rel="stylesheet" type="text/css" href="assets/datatables.min.css"/>
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<script src="https://use.fontawesome.com/b58b304000.js"></script>

</head>

<body>

<div class="container">

<form class="well form-horizontal" onsubmit="return fieldsEntered();" id="register_form">
<fieldset>

<!-- Form Name -->
<legend><center><h2><b>Global NL - Registration Form</b></h2></center></legend><br>

<!-- Text input-->

<div class="form-group">
<label class="col-md-4 control-label">First Name</label>
<div class="col-md-5 inputGroupContainer">
<div class="input-group">
<span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
<input name="first_name" id="first_name" placeholder="First Name" class="form-control"  type="text" required>
  </div>
</div>
</div>

<!-- Text input-->

<div class="form-group">
<label class="col-md-4 control-label" >Last Name</label>
  <div class="col-md-5 inputGroupContainer">
  <div class="input-group">
<span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
<input name="last_name" id="last_name" placeholder="Last Name" class="form-control"  type="text" required>
  </div>
</div>
</div>

<!-- Text input-->

<div class="form-group">
<label class="col-md-4 control-label" >Email</label>
  <div class="col-md-5 inputGroupContainer">
  <div class="input-group">
<span class="input-group-addon"><i class="glyphicon glyphicon-envelope"></i></span>
<input name="email" id="email" value="" class="form-control" type="text">
  </div>
</div>
</div>

<!-- Text input-->

<div class="form-group">
<label class="col-md-4 control-label">Current Location</label>
<div class="col-md-5 inputGroupContainer">
<div class="input-group">
<span class="input-group-addon"><i class="glyphicon glyphicon-globe"></i></span>
<input id="autocomplete_current" name="cl" placeholder="Where ya at" class="form-control" type="text" required>
  </div>
</div>
</div>

<!-- Text input-->

<div class="form-group">
<label class="col-md-4 control-label">Hometown / NL Roots</label>
<div class="col-md-5 inputGroupContainer">
<div class="input-group">
<span class="input-group-addon"><i class="glyphicon glyphicon-home"></i></span>
<input id="autocomplete_hometown" name="ht" placeholder="Where ya from or where are ya NL roots" class="form-control"  type="text" required>
  </div>
</div>
</div>

<!-- Text input-->

<div class="form-group">
<label class="col-md-4 control-label">LinkedIn Profile</label>
<div class="col-md-5 inputGroupContainer">
<div class="input-group">
<span class="input-group-addon"><i class="fa fa-linkedin"></i></span>
<input name="linkedin_profile" id="linkedin_profile" placeholder='https://www.linkedin.com/in/johndoe/' class="form-control"  type="text" required>
  </div>
</div>
</div>

<div class="form-group">
  <label class="col-md-4 control-label">Industry Sector</label>
    <div class="col-md-5 selectContainer">
    <div class="input-group">
        <span class="input-group-addon"><i class="fa fa-industry"></i></span>
    <select name="industry" id="industry" class="form-control selectpicker" onclick="changeSector();" required>
      <option value="">Select your Industry</option>
      <option>Accommodation and Food Services</option>
      <option>Administrative and Support</option>
      <option>Agriculture and Forestry</option></option>
      <option>Arts, Entertainment and Recreation</option>
      <option>Construction</option>
      <option>Education</option>
      <option>Finance and Insurance</option>
      <option>Fisheries and Aquaculture</option>
      <option>Health Care and Social Assistance</option>
      <option>Manufacturing</option>
      <option>Mining and Quarrying</option>
      <option>Oil & Gas</option>
      <option>Professional, Scientific and Technical Services</option>
      <option>Public Administration</option>
      <option>Real Estate and Rental and Leasing</option>
      <option>Retail</option>
      <option>Technology</option>
      <option>Transportation and Warehousing</option>
      <option>Utilities</option>
      <option>Waste Management and Remediation Services</option>
      <option>Wholesale Trade</option>
      <option>Other</option>
    </select>
  </div>
</div>
</div>

<div class="form-group" id="industry_other" style="display: none;">
<label class="col-md-4 control-label" ></label>
  <div class="col-md-5 inputGroupContainer">
  <div class="input-group">
<input name="industry_other" id="industry_other_box" class="form-control"  type="text">
  </div>
</div>
</div>

<div class="form-group">
  <label class="col-md-4 control-label">Status</label>
    <div class="col-md-5 selectContainer">
    <div class="input-group">
        <span class="input-group-addon"><i class="fa fa-id-badge"></i></span>
    <select name="status" id="status" class="form-control selectpicker" onclick="changeStatus();" required>
      <option value="">Select your status</option>
      <option>Student</option>
      <option>Non-student</option>
    </select>
  </div>
</div>
</div>

<div class="form-group" id="school" style="display: none;">
<label class="col-md-4 control-label" >School</label>
  <div class="col-md-5 inputGroupContainer">
  <div class="input-group">
<span class="input-group-addon"><i class="glyphicon glyphicon-education"></i></span>
<input name="school" id="school_box" placeholder="Memorial University of Newfoundland" class="form-control" type="text">
  </div>
</div>
</div>

<div class="form-group" id="program" style="display: none;">
<label class="col-md-4 control-label" >Program</label>
  <div class="col-md-5 inputGroupContainer">
  <div class="input-group">
<span class="input-group-addon"><i class="glyphicon glyphicon-education"></i></span>
<input name="program" id="program_box" placeholder="Bachelor of Electrical Engineering" class="form-control" type="text">
  </div>
</div>
</div>

<div class="form-group" id="grad_year" style="display: none;">
<label class="col-md-4 control-label" >Graduation Year</label>
  <div class="col-md-5 inputGroupContainer">
  <div class="input-group">
<span class="input-group-addon"><i class="glyphicon glyphicon-education"></i></span>
<input name="grad_year" id="grad_year_box" placeholder="2020" class="form-control"  type="text">
  </div>
</div>
</div>

<div class="form-group">
  <label class="col-md-4 control-label" >Interests</label>
  <div class="col-md-5 inputGroupContainer">
    <div class="checkbox">
      <label><input type="checkbox" id="connect">I want to connect with other Global NL members in my area</label>
    </div>
    <div class="checkbox">
      <label><input type="checkbox" id="organize">I want to help organize a Global NL event in my area</label>
    </div>
    <div class="checkbox ">
      <label><input type="checkbox" id="learn">I want to learn more about what other Global NL members are doing all over the world</label>
    </div>
    <div class="checkbox ">
      <label><input type="checkbox" id="mentor">I want to help mentor and support NL affiliated companies, organizations and individuals</label>
    </div>
    <div class="checkbox ">
      <label><input type="checkbox" id="support">I want to help with some of the behind the scenes heavy lifting</label>
    </div>
  </div>
</div>

<div class="form-group">
  <label class="col-md-4 control-label" >Comments</label>
  <div class="col-md-5 inputGroupContainer">
      <textarea name="comments" id="comments" class="form-control" placeholder="Anything else on your mind?" rows="4"></textarea>
  </div>
</div>

<div class="form-group">
  <label class="col-md-4 control-label" >Privacy</label>
  <div class="col-md-5 inputGroupContainer">
    <div class="radio">
      <label><input type="radio" name="privacy" value="public" required>I consent to my profile being publicly shared on the GlobalNL website (we will never share your email address)</label>
    </div>
    <div class="radio">
      <label><input type="radio" name="privacy" value="members">I consent to my profile being shared with other GlobalNL members only (we will never share your email address)</label>
    </div>
  </div>
</div>

<!-- Button -->
<div class="form-group">
<label class="col-md-4 control-label"></label>
<div class="col-md-4">
<input type="submit" class="btn btn-warning"></input>
</div>
</div>

</fieldset>

<div class="col-sm-12" align="right">
  <p>Â© 2017 Global NL</p>
</div>

</form>
</div>
</div>
<!-- /.container -->

<!-- Include Javascript Libraries -->
<script type="text/javascript" src="assets/datatables.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/4.6.2/firebase.js"></script>
<script src="/assets/firebase.js"></script>
<script src="/assets/member-auth.js"></script>

<!-- Javascript Code -->
<script>

// Member JSON Object
var member = {
  first_name:"John",
  last_name:"Doe",
  interests : {
    connect:false,
    organize:false,
    learn:false,
    mentor:false,
    support:false
  },
  current_address: {
    lat:500,
    lng:500
  },
  hometown_address: {
    lat:500,
    lng:500
  },
  approved:"No"
};

// Javascript to run once page is fully loaded
$(document).ready(function() {

  // Bias autocomplete_current with current location
  //geolocate();

  // Prevent the enter key from submitting the form when uncomplete
  $(window).keydown(function(event){
      if(event.keyCode == 13) {
        event.preventDefault();
        return false;
      }
    });

  $('#status').on('change',function(){
      if( $(this).val()==="Student"){
        $("#school").show();
        $("#program").show();
        $("#grad_year").show();
      }
      else {
        $("#school").hide();
        $("#program").hide();
        $("#grad_year").hide();
      }
  });

  $('#industry').on('change',function(){
      if( $(this).val()==="Other"){
        $("#industry_other").show();
      }
      else {
        $("#industry_other").hide();
      }
  });

});

function changeStatus(){
  if ($( "#status" ).val() == "Student") {
    document.getElementById("school_box").required = true;
    document.getElementById("program_box").required = true;
    document.getElementById("grad_year_box").required = true;
  }
  else {
    document.getElementById("school_box").required = false;
    document.getElementById("program_box").required = false;
    document.getElementById("grad_year_box").required = false;
  }
}

function changeSector() {
  if ($( "#industry" ).val() == "Other") {
    document.getElementById("industry_other_box").required = true;
  }
  else {
    document.getElementById("industry_other_box").required = false;
  }
}

function fieldsEntered() {
  register();
  return false;
}

function register() {

  var errors = false;
  $('#submit_handle').click();

  if (member["current_address"]["lat"] == 500) {
    alert("Error getting current address, please do not use auto fill form and enter address in manually using Google Places Autocomplete.");
    errors = true;
  }

  if (member["hometown_address"]["lat"] == 500) {
    alert("Error getting hometown address, please do not use auto fill form and enter address in manually using Google Places Autocomplete.");
    errors = true;
  }

  member["first_name"] = $( "#first_name" ).val();
  member["last_name"] = $( "#last_name" ).val();
  member["email"] = $( "#email" ).val();

  member["linkedin_profile"] = $( "#linkedin_profile" ).val().toLowerCase();
  if ($( "#linkedin_profile" ).val().includes("linkedin.com/in/")) {
    // good
  } else {
    alert("Error: Invalid LinkedIn Profile Entered. Please make sure your LinkedIn Profile cotains \"linkedin.com/in/\"");
    errors = true;
  }

  if ($( "industry" ).val() == "Other") {
    member["industry"] = $( "#industry_other_box" ).val();
  }
  else {
    member["industry"] = $( "#industry" ).val();
  }

  member["status"] = $( "#status" ).val();
  if ($( "#status" ).val() == "Student") {
    member["school"] = $( "#school_box" ).val();
    member["program"] = $( "#program_box" ).val();
    member["grad_year"] = parseInt($( "#grad_year_box" ).val());
  }
  else {
    delete member["school"];
    delete member["program"];
    delete member["grad_year"];
  }

  if ($( "#connect" ).is(':checked')) {
    member["interests"]["connect"] = true;
  }
  if ($( "#organize" ).is(':checked')) {
    member["interests"]["organize"] = true;
  }
  if ($( "#learn" ).is(':checked')) {
    member["interests"]["learn"] = true;
  }
  if ($( "#mentor" ).is(':checked')) {
    member["interests"]["mentor"] = true;
  }
  if ($( "#support" ).is(':checked')) {
    member["interests"]["support"] = true;
  }

  member["comments"] = $( "#comments" ).val();
  member["ambassador"] = "No";
  member["privacy"] = $('input[name=privacy]:checked').val();

  //console.log(member);

  // Need to add better validation
  Object.keys(member).forEach(function(key) {
    if(key != "approved" && key != "comments" && key != "linkedin_profile") {
      if (member[key] == undefined || member[key] == "") {
        //console.log(key + " Error.");
        errors = true;
      }
    }
  });

  if ($( "#autocomplete_current" ).val() == "" || $( "#autocomplete_hometown" ).val() == "") {
    //console.log("Address Error.");
    errors = true;
  }

  // Good to submit
  if (errors == false) {

    member["date_created"] = Date.now();

    rootRef.child('private/members/' + uid).set(member, function(error) {
      if(error == null) {
        alert('Registration Successful!');
        window.location.href = "https://www.globalnl.com";
      } else {
        alert(error);
        //window.location.href = "index.html";
      }
    });

  }

  return false;

}

var placeSearch, autocomplete;
var componentForm = {
  street_number: 'long_name',
  route: 'long_name',
  locality: 'long_name',
  administrative_area_level_1: 'long_name',
  country: 'long_name',
  postal_code: 'long_name'
};

function initAutocomplete() {
  autocomplete_current = new google.maps.places.Autocomplete(
      /** @type {!HTMLInputElement} */(document.getElementById('autocomplete_current')),
      {types: ['geocode']});
  autocomplete_hometown = new google.maps.places.Autocomplete(
      /** @type {!HTMLInputElement} */(document.getElementById('autocomplete_hometown')),
      {types: ['geocode']});

  autocomplete_current.addListener('place_changed', currentAddress);
  autocomplete_hometown.addListener('place_changed', hometownAddress);
}

function currentAddress() {
  var place = autocomplete_current.getPlace();

  for (var i = 0; i < place.address_components.length; i++) {
    var addressType = place.address_components[i].types[0];
    if (componentForm[addressType]) {
      var val = place.address_components[i][componentForm[addressType]];
      member["current_address"][addressType] = val;
    }
  }

  member["current_address"]["lat"] = place.geometry.location.lat();
  member["current_address"]["lng"] = place.geometry.location.lng();

}

function hometownAddress() {
  var place = autocomplete_hometown.getPlace();

  for (var i = 0; i < place.address_components.length; i++) {
    var addressType = place.address_components[i].types[0];
    if (componentForm[addressType]) {
      var val = place.address_components[i][componentForm[addressType]];
      member["hometown_address"][addressType] = val;
    }
  }

  member["hometown_address"]["lat"] = place.geometry.location.lat();
  member["hometown_address"]["lng"] = place.geometry.location.lng();

}

// Bias the autocomplete_current object to the user's geographical location,
// as supplied by the browser's 'navigator.geolocation' object.
function geolocate() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function(position) {
      var geolocation = {
        lat: position.coords.latitude,
        lng: position.coords.longitude
      };
      var circle = new google.maps.Circle({
        center: geolocation,
        radius: position.coords.accuracy
      });
      autocomplete_current.setBounds(circle.getBounds());
    });
  }
}

</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB1eOBITvxAHRcodvjmw4_fWQxQB_iKPKQ&libraries=places&callback=initAutocomplete"
        async defer></script>

<!-- Ending Tags -->
</body>
</html>
